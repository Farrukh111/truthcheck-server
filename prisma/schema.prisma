generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  createdAt DateTime @default(now())
  checks    Check[]
}

model Check {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())

  userId    String
  user      User     @relation(fields: [userId], references: [id])

  type      String   // "text", "video", "audio"
  content   String   // Текст или URL (желательно уже нормализованный)
  verdict   String   // "CONFIRMED", "CONTRADICTED", "DISPUTED", "UNCERTAIN"

  confidence Float?
  summary    String?
  aiModel    String?
  durationMs Int?
  keyClaim   String?
  sources    String?  // JSON строкой

  // ✅ NEW: Trust & Cache Layer (лучше НЕ nullable)
  pipelineVersion String @default("v1")
  fingerprint     String

  // Индексы под быстрый поиск и кэш-слои
  @@index([content])
  @@index([fingerprint])
  @@index([content, pipelineVersion])

  // Очень желательно: чтобы один fingerprint+pipelineVersion не плодил дубликаты
  @@unique([fingerprint, pipelineVersion])
}
